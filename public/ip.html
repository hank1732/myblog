<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Request Info</title>
    <link rel="stylesheet" href="./stylesheets/base.css">
    <link rel="stylesheet" href="./stylesheets/ip.css">
    <link rel="icon" href="img/fav2.png" />
</head>

<body>
    <header class="main-header">
        <a href="http://hankonline.cn">
            <img src="img/fav.png">
            <span>Hankonline</span> 
        </a>
    </header>
    <section class="main-wrapper">
        <section>
            <h1>Request Header Infomation</h1>
        </section>
        <section class="table-limit">   
            <input class="js-page" type="text" placeholder="input ID to go">
            <button class="js-go" >GO</button>
            <select class="js-limit">
                <option>5</option>
                <option>10</option>
                <option>20</option>
                <option>30</option>
                <option>50</option>
            </select>
        </section>
        <section>
            <table>
                <thead>
                    <tr>
                        <td>ID</td>
                        <td style="width: 100px;">TIME</td>
                        <td style="width: 200px;">IP/RemoteAddress</td>
                        <td>Host</td>
                        <td>Headers</td>
                    </tr>
                </thead>
                <tbody id="tbody"></tbody>
            </table>
        </section>    
    </section>
</body>
<script src="javascripts/jquery.min.js"></script>
<script type="text/javascript">
    var tbody = $('#tbody');
    var pageInput = $('.js-page');
    var limitInput = $('.js-limit');
    function getData (page, limit) {
        if(page === ''){
            page = 0;
        }
        console.log('get');
        $.ajax({
            url:'/ipData?page=' + page + '&limit='+ limit,
            contentType: "application/json; charset=UTF-8"
        }).done(function (data) {
            tbody.empty();
            var rows = JSON.parse(data).rows;
            $.each(rows, function (index, value) {
                var tr = $('<tr>');
                $('<td>').html(value['id']).appendTo(tr);
                $('<td>').html(value['time']).slice(-13).appendTo(tr);
                $('<td>').html('IP: ' + value['ip'] + '<br>' + 'RA: ' + value['remoteAddress']).appendTo(tr);
                $('<td>').html(value['host']).appendTo(tr);
                $('<td>').html(value['headers']).appendTo(tr);
                tr.prependTo(tbody);
            });
        });
    }
    $(getData(0,5));

    $('.js-go').click(function(event) {
        getData(pageInput.val(), limitInput.val());
    });
    $('.js-limit').change(function(event) {
        getData(pageInput.val(), limitInput.val())
    });
</script>
</html>
