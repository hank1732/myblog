<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Show IP</title>
    <link rel="stylesheet" href="./stylesheets/ip.css">
    <link rel="icon" href="fav2.png" />
</head>

<body>
    <input class="js-page" type="text">
    <button class="js-go" >GO</button>
    <select class="js-limit">
        <option>10</option>
        <option>20</option>
        <option>30</option>
        <option>50</option>
    </select>
    <table>
        <thead>
            <tr>
                <td>ID</td>
                <td style="width: 100px;">TIME</td>
                <td>IP or remoteAddress</td>
                <td>Headers</td>
            </tr>
        </thead>
        <tbody id="tbody"></tbody>
    </table>
</body>
<script src="javascripts/jquery.min.js"></script>
<script type="text/javascript">
    var tbody = $('#tbody');
    var pageInput = $('.js-page');
    var limitInput = $('.js-limit');
    function getData (page, limit) {
        if(page === ''){
            page = 0;
        }
        console.log('get');
        $.ajax({
            url:'/ipData?page=' + page + '&limit='+ limit,
            contentType: "application/json; charset=UTF-8"
        }).done(function (data) {
            tbody.empty();
            var rows = JSON.parse(data).rows;
            $.each(rows, function (index, value) {
                var tr = $('<tr>');
                $('<td>').html(value['id']).appendTo(tr);
                $('<td>').html(value['time']).slice(-13).appendTo(tr);
                $('<td>').html('IP: ' + value['ip'] + '<br>' + 'RA: ' + value['remoteAddress']).appendTo(tr);
                $('<td>').html(value['headers']).appendTo(tr);
                tr.prependTo(tbody);
            });
        });
    }
    $(getData(0,10));

    $('.js-go').click(function(event) {
        getData(pageInput.val(), limitInput.val());
    });
    $('.js-limit').change(function(event) {
        getData(pageInput.val(), limitInput.val())
    });
</script>
</html>
